local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local camera = game.Workspace.CurrentCamera

local shiftLocked = false
local rotationSpeed = 0.25

function enableShiftLock()
	if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
	shiftLocked = true
	camera.CameraType = Enum.CameraType.Scriptable
end

function disableShiftLock()
	shiftLocked = false
	camera.CameraType = Enum.CameraType.Custom
end

UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if input.KeyCode == Enum.KeyCode.LeftShift and not gameProcessed then
		if shiftLocked then
			disableShiftLock()
		else
			enableShiftLock()
		end
	end
end)

RunService.RenderStepped:Connect(function()
	if shiftLocked and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
		local root = player.Character.HumanoidRootPart
		local mouseDelta = UserInputService:GetMouseDelta()
		root.CFrame = root.CFrame * CFrame.Angles(0, -mouseDelta.X * rotationSpeed * math.pi/180, 0)
		camera.CFrame = CFrame.new(root.Position - root.CFrame.LookVector * 5 + Vector3.new(0, 2, 0), root.Position + Vector3.new(0, 2, 0))
	end
end)
